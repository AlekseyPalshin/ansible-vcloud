---
- name: upgrade all packages
  apt: update_cache=yes

- name: install required packages
  apt: pkg={{ item }} state=latest
  with_items:
  - python-psycopg2 
  - postgresql 
  - postgresql-contrib

- name: Make sure postgres is running
  service: name=postgresql state=started enabled=yes

- name: Create postgres database
  postgresql_db: name={{ irods_db_name }} state=present
  sudo: true
  sudo_user: postgres

- name: Create postgres user
  postgresql_user: name={{ irods_db_user }} password={{ irods_db_password }} db={{ irods_db_name }} priv=ALL encrypted=no state=present
  sudo: true
  sudo_user: postgres